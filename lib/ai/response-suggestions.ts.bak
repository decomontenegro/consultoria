/**
 * AI Response Suggestions Engine
 *
 * Generates contextual response suggestions based on AI questions
 * to guide users and improve UX in conversational flows
 */

export interface ResponseSuggestion {
  text: string;
  category?: string;
  icon?: string;
}

/**
 * Question patterns and their corresponding suggestions
 */
const SUGGESTION_PATTERNS: Record<string, ResponseSuggestion[]> = {
  // Challenges and Pain Points
  'desafio|problema|dificuldade|pain point': [
    { text: 'Produtividade baixa da equipe', icon: 'â±ï¸' },
    { text: 'Time-to-market muito lento', icon: 'ğŸš€' },
    { text: 'Dificuldade em contratar talentos', icon: 'ğŸ‘¥' },
    { text: 'Qualidade do cÃ³digo preocupante', icon: 'ğŸ›' },
    { text: 'Falta de inovaÃ§Ã£o tecnolÃ³gica', icon: 'ğŸ’¡' },
    { text: 'Custos operacionais altos', icon: 'ğŸ’°' },
  ],

  // Company Size
  'tamanho|porte|empresa|equipe|quantos': [
    { text: '5-20 pessoas (Startup)', icon: 'ğŸŒ±' },
    { text: '21-100 pessoas (Scaleup)', icon: 'ğŸ“ˆ' },
    { text: '101-500 pessoas (Mid-market)', icon: 'ğŸ¢' },
    { text: '500+ pessoas (Enterprise)', icon: 'ğŸ›ï¸' },
  ],

  // Industry
  'indÃºstria|setor|Ã¡rea|ramo': [
    { text: 'Tecnologia / SaaS', icon: 'ğŸ’»' },
    { text: 'Fintech / ServiÃ§os Financeiros', icon: 'ğŸ’³' },
    { text: 'E-commerce / Varejo', icon: 'ğŸ›’' },
    { text: 'SaÃºde / Healthcare', icon: 'ğŸ¥' },
    { text: 'EducaÃ§Ã£o / EdTech', icon: 'ğŸ“' },
    { text: 'Manufatura / IndÃºstria', icon: 'ğŸ­' },
  ],

  // Goals
  'objetivo|meta|quer|alcanÃ§ar|melhorar': [
    { text: 'Aumentar produtividade em 30%+', icon: 'ğŸ“Š' },
    { text: 'Acelerar time-to-market', icon: 'âš¡' },
    { text: 'Reduzir bugs e incidentes', icon: 'ğŸ›¡ï¸' },
    { text: 'Melhorar qualidade do cÃ³digo', icon: 'âœ¨' },
    { text: 'Atrair e reter talentos', icon: 'ğŸ¯' },
    { text: 'Reduzir custos operacionais', icon: 'ğŸ’µ' },
  ],

  // Timeline
  'prazo|timeline|quando|urgÃªncia|tempo': [
    { text: 'Urgente - prÃ³ximos 3 meses', icon: 'ğŸ”¥' },
    { text: 'Curto prazo - 6 meses', icon: 'â°' },
    { text: 'MÃ©dio prazo - 12 meses', icon: 'ğŸ“…' },
    { text: 'Longo prazo - 18+ meses', icon: 'ğŸ—“ï¸' },
  ],

  // Budget
  'orÃ§amento|budget|investimento|quanto': [
    { text: 'AtÃ© R$ 50k', icon: 'ğŸ’µ' },
    { text: 'R$ 50k - R$ 200k', icon: 'ğŸ’°' },
    { text: 'R$ 200k - R$ 500k', icon: 'ğŸ’¸' },
    { text: 'R$ 500k+', icon: 'ğŸ¦' },
    { text: 'Ainda nÃ£o definido', icon: 'â“' },
  ],

  // AI Adoption
  'ia|ai|inteligÃªncia artificial|ferramentas|copilot': [
    { text: 'NÃ£o usamos IA ainda', icon: 'ğŸ†•' },
    { text: 'Alguns devs testando', icon: 'ğŸ”¬' },
    { text: 'Piloto em andamento', icon: 'ğŸš€' },
    { text: 'Uso parcial em produÃ§Ã£o', icon: 'âš™ï¸' },
    { text: 'Totalmente integrado', icon: 'âœ…' },
  ],

  // Team Experience
  'experiÃªncia|senioridade|time|desenvolvedores': [
    { text: 'Maioria jÃºnior (0-2 anos)', icon: 'ğŸŒ±' },
    { text: 'Mix jÃºnior/pleno', icon: 'ğŸ“š' },
    { text: 'Maioria pleno (3-5 anos)', icon: 'âš™ï¸' },
    { text: 'Time sÃªnior (5+ anos)', icon: 'ğŸ“' },
    { text: 'Mix balanceado', icon: 'âš–ï¸' },
  ],

  // Development Practices
  'prÃ¡ticas|metodologia|processo|desenvolvimento': [
    { text: 'Agile / Scrum', icon: 'ğŸ”„' },
    { text: 'Kanban', icon: 'ğŸ“‹' },
    { text: 'DevOps / CI/CD', icon: 'ğŸ”§' },
    { text: 'Waterfall tradicional', icon: 'ğŸ“Š' },
    { text: 'Processo informal', icon: 'ğŸ¤·' },
  ],

  // Tech Stack
  'stack|tecnologia|linguagem|framework': [
    { text: 'JavaScript / TypeScript', icon: 'ğŸŸ¨' },
    { text: 'Python', icon: 'ğŸ' },
    { text: 'Java / Kotlin', icon: 'â˜•' },
    { text: 'C# / .NET', icon: 'ğŸ”·' },
    { text: 'Go / Rust', icon: 'ğŸ¦€' },
    { text: 'MÃºltiplas linguagens', icon: 'ğŸŒˆ' },
  ],

  // Deployment Frequency
  'deploy|implantaÃ§Ã£o|frequÃªncia|releases': [
    { text: 'VÃ¡rias vezes por dia', icon: 'ğŸš€' },
    { text: 'Diariamente', icon: 'ğŸ“…' },
    { text: 'Semanalmente', icon: 'ğŸ“†' },
    { text: 'Quinzenalmente', icon: 'ğŸ—“ï¸' },
    { text: 'Mensalmente ou menos', icon: 'â°' },
  ],

  // Yes/No confirmations
  'sim|nÃ£o|confirma|concorda': [
    { text: 'Sim', icon: 'âœ…' },
    { text: 'NÃ£o', icon: 'âŒ' },
    { text: 'Parcialmente', icon: 'ğŸ¤”' },
    { text: 'NÃ£o tenho certeza', icon: 'â“' },
  ],

  // Metrics Tracking
  'mÃ©tricas|kpi|medir|acompanhar': [
    { text: 'DORA metrics (deploy freq, lead time, MTTR, change failure)', icon: 'ğŸ“Š' },
    { text: 'Velocidade de sprint', icon: 'âš¡' },
    { text: 'Code coverage e qualidade', icon: 'âœ¨' },
    { text: 'Bug rate e incidents', icon: 'ğŸ›' },
    { text: 'Developer satisfaction', icon: 'ğŸ˜Š' },
    { text: 'NÃ£o medimos formalmente', icon: 'â“' },
  ],

  // Urgency Level
  'urgente|prioritÃ¡rio|crÃ­tico|importante': [
    { text: 'Extremamente urgente (semanas)', icon: 'ğŸ”¥' },
    { text: 'Alta prioridade (1-3 meses)', icon: 'âš¡' },
    { text: 'Prioridade mÃ©dia (3-6 meses)', icon: 'ğŸ“…' },
    { text: 'Planejamento (6+ meses)', icon: 'ğŸ—“ï¸' },
  ],
};

/**
 * Generate contextual response suggestions based on AI question
 */
export function generateSuggestions(aiQuestion: string): ResponseSuggestion[] {
  if (!aiQuestion) return [];

  const lowerQuestion = aiQuestion.toLowerCase();

  // Find matching pattern
  for (const [pattern, suggestions] of Object.entries(SUGGESTION_PATTERNS)) {
    const regex = new RegExp(pattern, 'i');
    if (regex.test(lowerQuestion)) {
      // Return first 4-5 suggestions (randomize a bit for variety)
      const shuffled = [...suggestions].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, 4);
    }
  }

  // Default suggestions if no pattern matches
  return [
    { text: 'Conte-me mais...', icon: 'ğŸ’¬' },
    { text: 'Preciso de ajuda para responder', icon: 'â“' },
    { text: 'Pular esta pergunta', icon: 'â­ï¸' },
  ];
}

/**
 * Get suggestions for specific specialist types
 */
export function getSpecialistSuggestions(
  specialistType: 'engineering' | 'product' | 'operations' | 'strategy' | 'technical',
  question: string
): ResponseSuggestion[] {

  const contextualSuggestions = generateSuggestions(question);

  // Add specialist-specific context if no match found
  if (contextualSuggestions.length <= 3) {
    const specialistDefaults: Record<string, ResponseSuggestion[]> = {
      'engineering': [
        { text: 'Produtividade da equipe', icon: 'âš¡' },
        { text: 'Qualidade do cÃ³digo', icon: 'âœ¨' },
        { text: 'Deploy e CI/CD', icon: 'ğŸš€' },
        { text: 'Tech debt', icon: 'ğŸ—ï¸' },
      ],
      'product': [
        { text: 'Time-to-market', icon: 'ğŸš€' },
        { text: 'Feature velocity', icon: 'ğŸ“ˆ' },
        { text: 'User feedback loop', icon: 'ğŸ’¬' },
        { text: 'Roadmap execution', icon: 'ğŸ—ºï¸' },
      ],
      'operations': [
        { text: 'AutomaÃ§Ã£o de processos', icon: 'ğŸ¤–' },
        { text: 'EficiÃªncia operacional', icon: 'âš™ï¸' },
        { text: 'Custos e recursos', icon: 'ğŸ’°' },
        { text: 'Escalabilidade', icon: 'ğŸ“Š' },
      ],
      'strategy': [
        { text: 'Competitividade no mercado', icon: 'ğŸ¯' },
        { text: 'ROI e mÃ©tricas', icon: 'ğŸ“Š' },
        { text: 'TransformaÃ§Ã£o digital', icon: 'ğŸ”„' },
        { text: 'Vantagem competitiva', icon: 'ğŸ†' },
      ],
      'technical': [
        { text: 'Arquitetura e escalabilidade', icon: 'ğŸ—ï¸' },
        { text: 'Performance e otimizaÃ§Ã£o', icon: 'âš¡' },
        { text: 'SeguranÃ§a e compliance', icon: 'ğŸ”’' },
        { text: 'Infraestrutura', icon: 'â˜ï¸' },
      ],
    };

    return specialistDefaults[specialistType] || contextualSuggestions;
  }

  return contextualSuggestions;
}

/**
 * Get suggestions for Express Mode
 */
export function getExpressModeSuggestions(question: string, questionNumber: number): ResponseSuggestion[] {

  // Generate based on question content first
  const contentSuggestions = generateSuggestions(question);

  if (contentSuggestions.length > 3) {
    return contentSuggestions.slice(0, 4);
  }

  // Fallback based on question number
  const fallbacksByPhase: Record<number, ResponseSuggestion[]> = {
    1: [ // Usually about challenges
      { text: 'Produtividade', icon: 'â±ï¸' },
      { text: 'Qualidade', icon: 'âœ¨' },
      { text: 'Velocidade', icon: 'ğŸš€' },
      { text: 'Custos', icon: 'ğŸ’°' },
    ],
    2: [ // Usually about goals
      { text: 'Melhorar eficiÃªncia', icon: 'ğŸ“Š' },
      { text: 'Acelerar entregas', icon: 'âš¡' },
      { text: 'Reduzir bugs', icon: 'ğŸ›¡ï¸' },
      { text: 'Aumentar inovaÃ§Ã£o', icon: 'ğŸ’¡' },
    ],
    3: [ // Usually about timeline
      { text: '3 meses', icon: 'ğŸ”¥' },
      { text: '6 meses', icon: 'ğŸ“…' },
      { text: '12 meses', icon: 'ğŸ—“ï¸' },
    ],
  };

  return fallbacksByPhase[Math.min(questionNumber, 3)] || contentSuggestions;
}

/**
 * Common quick responses for any AI interaction
 */
export const COMMON_QUICK_RESPONSES: ResponseSuggestion[] = [
  { text: 'Sim, exatamente', icon: 'âœ…' },
  { text: 'NÃ£o, diferente', icon: 'âŒ' },
  { text: 'Mais ou menos', icon: 'ğŸ¤”' },
  { text: 'NÃ£o sei responder', icon: 'â“' },
];
